#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <ncurses.h>
#include "functions.h"

/**
 * @brief Reads coordinates from a binary file and plots them in the terminal with a tracing effect.
 * The function uses ncurses to draw characters at specific coordinates while clearing older points.
 * @return 0 if the program exits successfully.
 */
int main() {
    const char *file_path = "mouse_data.dat";  // Path to the binary file
    FILE *input_file = fopen(file_path, "rb");

    if (!input_file) {
        perror("Error opening binary file");
        return 1;
    }

    // Initialize ncurses
    initscr();            // Start ncurses mode
    cbreak();             // Disable line buffering
    noecho();             // Don't show input on the screen
    curs_set(0);          // Hide the cursor

    int term_width, term_height;          // Current terminal dimensions
    int base_width = 100, base_height = 25;  // Dimensions during recording
    int x, y;                             // Raw coordinates from the file
    int scaled_x, scaled_y;               // Scaled coordinates for plotting
    int last_x = -1, last_y = -1;         // Coordinates of the previous point

    printf("Plotting mouse movements, Press Ctrl+C to stop.\n");
    sleep(1);  // Wait a moment before clearing the terminal

    // Main plotting loop
    while (fread(&x, sizeof(int), 1, input_file) == 1 &&
           fread(&y, sizeof(int), 1, input_file) == 1) {
        // Dynamically get the current terminal dimensions
        GetTerminalDimensions(&term_width, &term_height);

        // Rescale coordinates to fit the current terminal size
        ScaleCoordinates(x, y, base_width, base_height, term_width, term_height, &scaled_x, &scaled_y);

        // Clamp coordinates to ensure they're within bounds
        ClampCoordinates(&scaled_x, &scaled_y, term_width, term_height);

        // Clear the last plotted point (leave a fading effect by not clearing everything)
        if (last_x != -1 && last_y != -1) {
            mvaddch(last_y, last_x, ' ');  // Clear the previous point
        }

        // Plot the new coordinate
        mvaddch(scaled_y, scaled_x, '*');  // Place '*' at (scaled_x, scaled_y)
        refresh();                         // Update the screen

        // Update the last plotted point
        last_x = scaled_x;
        last_y = scaled_y;

        // Debugging output (optional)
        printf("Plotted: Raw X=%d, Y=%d | Scaled X=%d, Y=%d\n", x, y, scaled_x, scaled_y);

        // Wait 10ms before plotting the next point
        usleep(10000);
    }

    // Clean up resources
    endwin();          // Exit ncurses mode
    fclose(input_file); // Close the binary file

    return 0;
}


________________________________________________________________________________________
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <ncurses.h>
#include "functions.h"

#define TRAIL_LENGTH 10 // Length of the trail effect

/**
 * @brief Reads coordinates from a binary file and plots them in the terminal
 *        with a trailing effect.
 * @return 0 if the program exits successfully.
 */
int main()
{
    const char *file_path = "mouse_data.dat"; // Path to the binary file
    FILE *input_file = fopen(file_path, "rb");
    if (!input_file)
    {
        perror("Error opening binary file");
        return 1;
    }

    // Initialize ncurses
    initscr();
    cbreak();
    noecho();
    curs_set(0); // Hide the cursor

    printf("Starting mouse plotter. Press Ctrl+C to stop.\n");
    sleep(1); // Brief delay before clearing

    // Initialize variables for plotting
    int x, y;
    int trail_x[TRAIL_LENGTH] = {0}; // Store the X positions of the trail
    int trail_y[TRAIL_LENGTH] = {0}; // Store the Y positions of the trail
    int trail_index = 0;             // Index for the trail

    while (fread(&x, sizeof(int), 1, input_file) == 1 &&
           fread(&y, sizeof(int), 1, input_file) == 1)
    {
        // Draw the current position
        mvaddch(y, x, '*');
        refresh();

        // Clear the old position from the trail
        if (trail_index >= TRAIL_LENGTH)
        {
            int clear_x = trail_x[trail_index % TRAIL_LENGTH];
            int clear_y = trail_y[trail_index % TRAIL_LENGTH];
            mvaddch(clear_y, clear_x, ' '); // Erase the character
        }

        // Save the current position in the trail
        trail_x[trail_index % TRAIL_LENGTH] = x;
        trail_y[trail_index % TRAIL_LENGTH] = y;
        trail_index++;

        // Add a short delay to control the plotting speed
        usleep(10000);
    }

    // Clean up resources
    endwin(); // Exit ncurses mode
    fclose(input_file);

    return 0;
}
